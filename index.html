<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Habits Flow</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      color-scheme: light;
      --bg: #f1f3f4;
      --card: #ffffff;
      --text: #202124;
      --muted: #5f6368;
      --accent: #1a73e8;
      --border: #e0e0e0;
      --shadow: 0 2px 8px rgba(32, 33, 36, 0.18);
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Roboto", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    button {
      font-family: inherit;
    }

    .app-shell {
      max-width: 520px;
      margin: 0 auto;
      padding: 14px 16px 90px;
    }

    .top-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 4px 18px;
    }

    .top-bar h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 500;
      flex: 1;
    }

    .icon-button {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: transparent;
      display: grid;
      place-items: center;
      color: var(--muted);
      font-size: 18px;
      cursor: pointer;
    }

    .icon-button:hover {
      background: rgba(60, 64, 67, 0.08);
    }

    .profile-chip {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e8f0fe;
      color: var(--accent);
      display: grid;
      place-items: center;
      font-weight: 700;
      font-size: 12px;
    }

    .task-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px 0 8px;
    }

    .task-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px 10px;
      border-bottom: 1px solid var(--border);
    }

    .list-title {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 16px;
      font-weight: 500;
    }

    .add-task-row {
      width: 100%;
      border: none;
      background: transparent;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px 12px;
      font-size: 14px;
      cursor: pointer;
      border-bottom: 1px solid var(--border);
    }

    .add-task-row .plus {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid var(--accent);
      display: grid;
      place-items: center;
      font-weight: 700;
      font-size: 12px;
    }

    .task-items {
      padding: 6px 16px 8px;
      display: grid;
      gap: 12px;
    }

    .task-item {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 12px;
      align-items: start;
    }

    .check-button {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #9aa0a6;
      background: #fff;
      cursor: pointer;
      margin-top: 2px;
    }

    .check-button.is-complete {
      background: var(--accent);
      border-color: var(--accent);
      position: relative;
    }

    .check-button.is-complete::after {
      content: "✓";
      position: absolute;
      inset: 0;
      color: #fff;
      font-size: 12px;
      display: grid;
      place-items: center;
    }

    .task-main h3 {
      margin: 0;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
    }

    .task-meta {
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
    }

    .empty-state {
      font-size: 13px;
      color: var(--muted);
      padding: 8px 0 6px;
    }

    .fab {
      position: fixed;
      right: 20px;
      bottom: 20px;
      width: 52px;
      height: 52px;
      border-radius: 50%;
      border: none;
      background: var(--accent);
      color: #fff;
      font-size: 28px;
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.35);
      cursor: pointer;
    }

    .habit-dialog {
      border: none;
      border-radius: 18px;
      padding: 0;
      width: min(480px, 90vw);
      box-shadow: var(--shadow);
    }

    .habit-dialog form {
      display: grid;
      gap: 12px;
      padding: 20px;
    }

    .habit-dialog label,
    .habit-dialog fieldset {
      display: grid;
      gap: 6px;
      font-size: 13px;
    }

    .habit-dialog input,
    .habit-dialog select,
    .habit-dialog textarea {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 14px;
    }

    .day-grid {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }

    .day-grid label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }

    .dialog-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding-top: 10px;
      margin: 0;
    }

    .dialog-actions button {
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid var(--border);
      cursor: pointer;
      background: #fff;
    }

    .dialog-actions .primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .dialog-actions .ghost {
      background: #f1f3f4;
    }

    @media (max-width: 640px) {
      .app-shell {
        padding: 12px 12px 90px;
      }

      .top-bar {
        padding-bottom: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="top-bar">
      <button class="icon-button" aria-label="Open menu">☰</button>
      <h1>Habits</h1>
      <button class="icon-button" aria-label="List options">≡</button>
      <button class="icon-button" aria-label="More options">⋮</button>
      <div class="profile-chip" aria-hidden="true">HF</div>
    </header>

    <main>
      <section class="task-card" aria-label="Tasks list">
        <div class="task-card-header">
          <div class="list-title">
            <span>My tasks</span>
            <button class="icon-button" aria-label="Select list">▾</button>
          </div>
          <button class="icon-button" aria-label="List settings">⋮</button>
        </div>
        <button class="add-task-row" data-action="open-create" aria-label="Add a task">
          <span class="plus">+</span>
          <span>Add a task</span>
        </button>
        <div class="task-items" id="habitList"></div>
      </section>
    </main>
  </div>

  <button class="fab" data-action="open-create" aria-label="Create task">+</button>

  <dialog id="habitDialog" class="habit-dialog">
    <form id="habitForm" method="dialog">
      <header>
        <h3 id="dialogTitle">New habit</h3>
        <p class="subtle">Define the habit and its schedule.</p>
      </header>

      <label>
        Habit name
        <input type="text" id="habitName" name="name" required maxlength="60" placeholder="Walk after lunch" />
      </label>

      <label>
        Frequency
        <select id="habitFrequency" name="frequency">
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
        </select>
      </label>

      <fieldset id="weeklyDays" class="day-grid">
        <legend>Weekly days</legend>
        <label><input type="checkbox" value="1" />Mon</label>
        <label><input type="checkbox" value="2" />Tue</label>
        <label><input type="checkbox" value="3" />Wed</label>
        <label><input type="checkbox" value="4" />Thu</label>
        <label><input type="checkbox" value="5" />Fri</label>
        <label><input type="checkbox" value="6" />Sat</label>
        <label><input type="checkbox" value="0" />Sun</label>
      </fieldset>

      <label class="toggle">
        <input type="checkbox" id="habitReminder" />
        <span>Enable reminder</span>
      </label>

      <label>
        Notes
        <textarea id="habitNotes" name="notes" rows="3" placeholder="Why does this habit matter?"></textarea>
      </label>

      <menu class="dialog-actions">
        <button value="cancel" data-action="close-dialog" type="button" class="ghost">Cancel</button>
        <button value="save" type="submit" class="primary">Save habit</button>
      </menu>
    </form>
  </dialog>

  <script>
    const STORAGE_KEY = "habits-flow-v1";

    const seedHabits = [
      {
        id: crypto.randomUUID(),
        name: "Morning stretch",
        frequency: "daily",
        days: [0, 1, 2, 3, 4, 5, 6],
        reminder: true,
        notes: "Five minutes to wake up the body.",
        logs: {}
      },
      {
        id: crypto.randomUUID(),
        name: "Read 20 pages",
        frequency: "weekly",
        days: [1, 3, 5],
        reminder: false,
        notes: "Wind down with a book.",
        logs: {}
      }
    ];

    let state = { habits: [] };

    const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    const formatISO = (date) => date.toISOString().slice(0, 10);

    const todayISO = () => formatISO(new Date());

    const loadState = () => {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        state = JSON.parse(stored);
      } else {
        state = { habits: seedHabits };
        saveState();
      }
      return state;
    };

    const saveState = () => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    };

    const getState = () => state;

    const addHabit = (habit) => {
      state.habits.push(habit);
      saveState();
    };

    const updateHabit = (id, updates) => {
      const habit = state.habits.find((item) => item.id === id);
      if (!habit) return;
      Object.assign(habit, updates);
      saveState();
    };

    const toggleCompletion = (id, dateISO) => {
      const habit = state.habits.find((item) => item.id === id);
      if (!habit) return;
      habit.logs[dateISO] = !habit.logs[dateISO];
      saveState();
    };

    const nextDueLabel = (habit) => {
      if (habit.frequency === "daily") {
        return "Every day";
      }
      const days = habit.days.map((day) => dayNames[day]).join(", ");
      return `Weekly · ${days}`;
    };

    const createHabitPayload = ({ name, frequency, days, reminder, notes }) => ({
      id: crypto.randomUUID(),
      name,
      frequency,
      days,
      reminder,
      notes,
      logs: {}
    });

    const dialog = document.getElementById("habitDialog");
    const habitForm = document.getElementById("habitForm");
    const dialogTitle = document.getElementById("dialogTitle");
    const habitFrequency = document.getElementById("habitFrequency");
    const weeklyDays = document.getElementById("weeklyDays");

    let editingId = null;

    const getSelectedDays = () =>
      [...weeklyDays.querySelectorAll("input[type='checkbox']")]
        .filter((input) => input.checked)
        .map((input) => Number(input.value));

    const setSelectedDays = (days) => {
      weeklyDays.querySelectorAll("input[type='checkbox']").forEach((input) => {
        input.checked = days.includes(Number(input.value));
      });
    };

    const resetForm = () => {
      habitForm.reset();
      editingId = null;
      setSelectedDays([1, 2, 3, 4, 5]);
      dialogTitle.textContent = "New habit";
      weeklyDays.hidden = habitFrequency.value !== "weekly";
    };

    const renderHabits = () => {
      const { habits } = getState();
      const habitList = document.getElementById("habitList");

      if (!habits.length) {
        habitList.innerHTML = '<div class="empty-state">No tasks yet.</div>';
        return;
      }

      habitList.innerHTML = habits
        .map((habit) => {
          const isComplete = habit.logs[todayISO()];
          return `
            <div class="task-item">
              <button class="check-button ${isComplete ? "is-complete" : ""}" data-action="toggle" data-id="${habit.id}" aria-pressed="${!!isComplete}" aria-label="Toggle ${habit.name}"></button>
              <div class="task-main">
                <h3>${habit.name}</h3>
                <div class="task-meta">${nextDueLabel(habit)}</div>
              </div>
            </div>
          `;
        })
        .join("");
    };

    const renderStreaks = () => {
      const { habits } = getState();
      if (!habits.length) {
        habitList.innerHTML = '<div class="empty-state">No tasks yet.</div>';
      }
    };

    const renderAll = () => {
      renderHabits();
    };

    const openDialog = (habit) => {
      dialog.showModal();
      if (habit) {
        editingId = habit.id;
        dialogTitle.textContent = "Edit habit";
        habitForm.querySelector("#habitName").value = habit.name;
        habitFrequency.value = habit.frequency;
        setSelectedDays(habit.days);
        habitForm.querySelector("#habitReminder").checked = habit.reminder;
        habitForm.querySelector("#habitNotes").value = habit.notes || "";
      } else {
        resetForm();
      }
      weeklyDays.hidden = habitFrequency.value !== "weekly";
    };

    const handleHabitAction = (action, id) => {
      if (action === "toggle") {
        toggleCompletion(id, todayISO());
        renderAll();
        return;
      }
      if (action === "edit") {
        const habit = getState().habits.find((item) => item.id === id);
        if (habit) openDialog(habit);
      }
    };

    habitFrequency.addEventListener("change", () => {
      weeklyDays.hidden = habitFrequency.value !== "weekly";
    });

    habitForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const name = habitForm.querySelector("#habitName").value.trim();
      const frequency = habitFrequency.value;
      const selectedDays = getSelectedDays();
      const days = frequency === "weekly"
        ? (selectedDays.length ? selectedDays : [new Date().getDay()])
        : [0, 1, 2, 3, 4, 5, 6];
      const reminder = habitForm.querySelector("#habitReminder").checked;
      const notes = habitForm.querySelector("#habitNotes").value.trim();

      if (!name) return;

      if (editingId) {
        updateHabit(editingId, { name, frequency, days, reminder, notes });
      } else {
        addHabit(createHabitPayload({ name, frequency, days, reminder, notes }));
      }

      dialog.close();
      resetForm();
      renderAll();
    });

    habitForm.addEventListener("click", (event) => {
      if (event.target?.dataset.action === "close-dialog") {
        dialog.close();
        resetForm();
      }
    });

    window.addEventListener("click", (event) => {
      const action = event.target?.dataset.action;
      if (!action) return;

      if (action === "open-create") {
        openDialog();
        return;
      }

      const id = event.target.dataset.id;
      if (id) {
        handleHabitAction(action, id);
      }
    });

    loadState();
    resetForm();
    renderAll();
  </script>
</body>
</html>
