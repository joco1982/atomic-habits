<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Habits Flow</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      color-scheme: light;
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #1f1f1f;
      --muted: #5f6368;
      --accent: #1a73e8;
      --border: #e1e3ea;
      --shadow: 0 6px 20px rgba(32, 33, 36, 0.08);
      --radius: 16px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Roboto", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .app {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px 20px 48px;
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .app-header h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
    }

    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 11px;
      color: var(--muted);
      margin: 0 0 6px;
    }

    .subtle {
      color: var(--muted);
      font-size: 14px;
      margin: 6px 0 0;
    }

    .profile-chip {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #e8f0fe;
      color: var(--accent);
      display: grid;
      place-items: center;
      font-weight: 700;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }

    .action-pill {
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 999px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: var(--shadow);
    }

    .action-pill .icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #e8f0fe;
      display: grid;
      place-items: center;
      color: var(--accent);
      font-size: 16px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .card-header h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    .card-body {
      padding: 16px 20px 20px;
      display: grid;
      gap: 12px;
    }

    .progress-ring {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: 6px solid #e8f0fe;
      display: grid;
      place-items: center;
      color: var(--accent);
      font-weight: 700;
    }

    .habit-item {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 14px;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .habit-item:last-child {
      border-bottom: none;
    }

    .check-button {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 2px solid var(--border);
      background: #fff;
      cursor: pointer;
    }

    .check-button.is-complete {
      background: var(--accent);
      border-color: var(--accent);
      position: relative;
    }

    .check-button.is-complete::after {
      content: "‚úì";
      position: absolute;
      inset: 0;
      color: #fff;
      font-size: 16px;
      display: grid;
      place-items: center;
    }

    .habit-main h3 {
      margin: 0;
      font-size: 15px;
      font-weight: 500;
    }

    .habit-meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 12px;
      color: var(--muted);
    }

    .habit-actions {
      display: flex;
      gap: 8px;
    }

    .habit-actions button {
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 10px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      background: #e8f0fe;
      color: var(--accent);
      font-size: 11px;
    }

    .analytics-grid {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }

    .analytics-card {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px 14px;
      background: #f8f9ff;
    }

    .analytics-card h4 {
      margin: 0 0 8px;
      font-size: 14px;
    }

    .analytics-card p {
      margin: 0;
      font-size: 13px;
      color: var(--muted);
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 12px;
    }

    .habit-dialog {
      border: none;
      border-radius: 18px;
      padding: 0;
      width: min(480px, 90vw);
      box-shadow: var(--shadow);
    }

    .habit-dialog form {
      display: grid;
      gap: 12px;
      padding: 20px;
    }

    .habit-dialog label,
    .habit-dialog fieldset {
      display: grid;
      gap: 6px;
      font-size: 13px;
    }

    .habit-dialog input,
    .habit-dialog select,
    .habit-dialog textarea {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 14px;
    }

    .day-grid {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }

    .day-grid label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }

    .dialog-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding-top: 10px;
      margin: 0;
    }

    .dialog-actions button {
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid var(--border);
      cursor: pointer;
      background: #fff;
    }

    .dialog-actions .primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .dialog-actions .ghost {
      background: #f1f3f4;
    }

    @media (max-width: 640px) {
      .app {
        padding: 16px 14px 36px;
      }

      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .habit-item {
        grid-template-columns: auto 1fr;
      }

      .habit-actions {
        width: 100%;
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div>
        <p class="eyebrow">Today</p>
        <h1>Habits</h1>
        <p class="subtle" id="dateLabel"></p>
      </div>
      <div class="profile-chip" aria-hidden="true">HF</div>
    </header>

    <main>
      <section class="quick-actions" aria-label="Habit actions">
        <button class="action-pill" data-action="open-create">
          <span class="icon">Ôºã</span>
          <span>New habit</span>
        </button>
        <button class="action-pill" data-action="show-streaks">
          <span class="icon">üî•</span>
          <span>Streaks</span>
        </button>
        <button class="action-pill" data-action="show-schedule">
          <span class="icon">üóìÔ∏è</span>
          <span>Schedule</span>
        </button>
        <button class="action-pill" data-action="show-reminders">
          <span class="icon">üîî</span>
          <span>Reminders</span>
        </button>
        <button class="action-pill" data-action="show-analytics">
          <span class="icon">üìà</span>
          <span>Analytics</span>
        </button>
      </section>

      <section class="card" aria-labelledby="todayTitle">
        <div class="card-header">
          <div>
            <h2 id="todayTitle">Today</h2>
            <p class="subtle" id="todaySummary"></p>
          </div>
          <div class="progress-ring" aria-hidden="true">
            <span id="todayProgress">0%</span>
          </div>
        </div>
        <div class="card-body" id="todayList"></div>
      </section>

      <section class="card" aria-labelledby="habitsTitle">
        <div class="card-header">
          <div>
            <h2 id="habitsTitle">All habits</h2>
            <p class="subtle" id="habitCount"></p>
          </div>
        </div>
        <div class="card-body" id="habitList"></div>
      </section>

      <section class="card" id="panel-streaks" hidden>
        <div class="card-header">
          <div>
            <h2>Streaks</h2>
            <p class="subtle">Consecutive completions for each habit.</p>
          </div>
        </div>
        <div class="card-body" id="streakList"></div>
      </section>

      <section class="card" id="panel-schedule" hidden>
        <div class="card-header">
          <div>
            <h2>Schedule</h2>
            <p class="subtle">When habits are due this week.</p>
          </div>
        </div>
        <div class="card-body" id="scheduleList"></div>
      </section>

      <section class="card" id="panel-reminders" hidden>
        <div class="card-header">
          <div>
            <h2>Reminders</h2>
            <p class="subtle">Toggle gentle reminders for each habit.</p>
          </div>
        </div>
        <div class="card-body" id="reminderList"></div>
      </section>

      <section class="card" id="panel-analytics" hidden>
        <div class="card-header">
          <div>
            <h2>Analytics</h2>
            <p class="subtle">Completion rate, streak length, and missed days.</p>
          </div>
        </div>
        <div class="card-body" id="analyticsPanel"></div>
      </section>
    </main>
  </div>

  <dialog id="habitDialog" class="habit-dialog">
    <form id="habitForm" method="dialog">
      <header>
        <h3 id="dialogTitle">New habit</h3>
        <p class="subtle">Define the habit and its schedule.</p>
      </header>

      <label>
        Habit name
        <input type="text" id="habitName" name="name" required maxlength="60" placeholder="Walk after lunch" />
      </label>

      <label>
        Frequency
        <select id="habitFrequency" name="frequency">
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
        </select>
      </label>

      <fieldset id="weeklyDays" class="day-grid">
        <legend>Weekly days</legend>
        <label><input type="checkbox" value="1" />Mon</label>
        <label><input type="checkbox" value="2" />Tue</label>
        <label><input type="checkbox" value="3" />Wed</label>
        <label><input type="checkbox" value="4" />Thu</label>
        <label><input type="checkbox" value="5" />Fri</label>
        <label><input type="checkbox" value="6" />Sat</label>
        <label><input type="checkbox" value="0" />Sun</label>
      </fieldset>

      <label class="toggle">
        <input type="checkbox" id="habitReminder" />
        <span>Enable reminder</span>
      </label>

      <label>
        Notes
        <textarea id="habitNotes" name="notes" rows="3" placeholder="Why does this habit matter?"></textarea>
      </label>

      <menu class="dialog-actions">
        <button value="cancel" data-action="close-dialog" type="button" class="ghost">Cancel</button>
        <button value="save" type="submit" class="primary">Save habit</button>
      </menu>
    </form>
  </dialog>

  <script>
    const STORAGE_KEY = "habits-flow-v1";

    const seedHabits = [
      {
        id: crypto.randomUUID(),
        name: "Morning stretch",
        frequency: "daily",
        days: [0, 1, 2, 3, 4, 5, 6],
        reminder: true,
        notes: "Five minutes to wake up the body.",
        logs: {}
      },
      {
        id: crypto.randomUUID(),
        name: "Read 20 pages",
        frequency: "weekly",
        days: [1, 3, 5],
        reminder: false,
        notes: "Wind down with a book.",
        logs: {}
      }
    ];

    let state = { habits: [] };

    const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    const formatISO = (date) => date.toISOString().slice(0, 10);

    const todayISO = () => formatISO(new Date());

    const loadState = () => {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        state = JSON.parse(stored);
      } else {
        state = { habits: seedHabits };
        saveState();
      }
      return state;
    };

    const saveState = () => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    };

    const getState = () => state;

    const addHabit = (habit) => {
      state.habits.push(habit);
      saveState();
    };

    const updateHabit = (id, updates) => {
      const habit = state.habits.find((item) => item.id === id);
      if (!habit) return;
      Object.assign(habit, updates);
      saveState();
    };

    const removeHabit = (id) => {
      state.habits = state.habits.filter((habit) => habit.id !== id);
      saveState();
    };

    const toggleCompletion = (id, dateISO) => {
      const habit = state.habits.find((item) => item.id === id);
      if (!habit) return;
      habit.logs[dateISO] = !habit.logs[dateISO];
      saveState();
    };

    const isDueOn = (habit, date) => {
      if (habit.frequency === "daily") {
        return true;
      }
      const day = date.getDay();
      return habit.days.includes(day);
    };

    const nextDueLabel = (habit) => {
      if (habit.frequency === "daily") {
        return "Every day";
      }
      const days = habit.days.map((day) => dayNames[day]).join(", ");
      return `Weekly ¬∑ ${days}`;
    };

    const getCompletionRate = (habit, range = 14) => {
      const today = new Date();
      let due = 0;
      let done = 0;
      for (let i = 0; i < range; i += 1) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        if (isDueOn(habit, date)) {
          due += 1;
          if (habit.logs[formatISO(date)]) {
            done += 1;
          }
        }
      }
      return due === 0 ? 0 : Math.round((done / due) * 100);
    };

    const getMissedDays = (habit, range = 14) => {
      const today = new Date();
      let missed = 0;
      for (let i = 0; i < range; i += 1) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        if (isDueOn(habit, date) && !habit.logs[formatISO(date)]) {
          missed += 1;
        }
      }
      return missed;
    };

    const getStreak = (habit) => {
      const today = new Date();
      let streak = 0;
      for (let i = 0; i < 60; i += 1) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        if (!isDueOn(habit, date)) {
          continue;
        }
        if (habit.logs[formatISO(date)]) {
          streak += 1;
        } else {
          break;
        }
      }
      return streak;
    };

    const getTodayStats = () => {
      const today = new Date();
      const dueHabits = state.habits.filter((habit) => isDueOn(habit, today));
      const completed = dueHabits.filter((habit) => habit.logs[todayISO()]).length;
      return {
        dueHabits,
        completed,
        total: dueHabits.length
      };
    };

    const createHabitPayload = ({ name, frequency, days, reminder, notes }) => ({
      id: crypto.randomUUID(),
      name,
      frequency,
      days,
      reminder,
      notes,
      logs: {}
    });

    const dialog = document.getElementById("habitDialog");
    const habitForm = document.getElementById("habitForm");
    const dialogTitle = document.getElementById("dialogTitle");
    const habitFrequency = document.getElementById("habitFrequency");
    const weeklyDays = document.getElementById("weeklyDays");

    let editingId = null;

    const formatDateLabel = () => {
      const now = new Date();
      return now.toLocaleDateString(undefined, {
        weekday: "long",
        month: "long",
        day: "numeric"
      });
    };

    const getSelectedDays = () =>
      [...weeklyDays.querySelectorAll("input[type='checkbox']")]
        .filter((input) => input.checked)
        .map((input) => Number(input.value));

    const setSelectedDays = (days) => {
      weeklyDays.querySelectorAll("input[type='checkbox']").forEach((input) => {
        input.checked = days.includes(Number(input.value));
      });
    };

    const resetForm = () => {
      habitForm.reset();
      editingId = null;
      setSelectedDays([1, 2, 3, 4, 5]);
      dialogTitle.textContent = "New habit";
      weeklyDays.hidden = habitFrequency.value !== "weekly";
    };

    const togglePanels = (panelId) => {
      ["panel-streaks", "panel-schedule", "panel-reminders", "panel-analytics"].forEach((id) => {
        const panel = document.getElementById(id);
        panel.hidden = id !== panelId;
      });
    };

    const renderToday = () => {
      const { dueHabits, completed, total } = getTodayStats();
      const todayList = document.getElementById("todayList");
      const todaySummary = document.getElementById("todaySummary");
      const todayProgress = document.getElementById("todayProgress");
      const progress = total === 0 ? 0 : Math.round((completed / total) * 100);

      todaySummary.textContent = total === 0 ? "No habits due today." : `${completed} of ${total} complete`;
      todayProgress.textContent = `${progress}%`;

      const todayItems = dueHabits
        .map((habit) => {
          const isComplete = habit.logs[todayISO()];
          return `
            <div class="habit-item">
              <button class="check-button ${isComplete ? "is-complete" : ""}" data-action="toggle" data-id="${habit.id}" aria-pressed="${isComplete}" aria-label="Toggle ${habit.name}"></button>
              <div class="habit-main">
                <h3>${habit.name}</h3>
                <div class="habit-meta">
                  <span>${nextDueLabel(habit)}</span>
                  <span class="badge">Streak ${getStreak(habit)}</span>
                </div>
              </div>
            </div>
          `;
        })
        .join("");
      todayList.innerHTML = todayItems || `<p class="subtle">Nothing scheduled for today.</p>`;
    };

    const renderHabits = () => {
      const { habits } = getState();
      const habitList = document.getElementById("habitList");
      const habitCount = document.getElementById("habitCount");

      habitCount.textContent = `${habits.length} habits tracked`;

      habitList.innerHTML = habits
        .map((habit) => {
          const completionRate = getCompletionRate(habit);
          return `
            <div class="habit-item">
              <button class="check-button ${habit.logs[todayISO()] ? "is-complete" : ""}" data-action="toggle" data-id="${habit.id}" aria-pressed="${!!habit.logs[todayISO()]}" aria-label="Toggle ${habit.name}"></button>
              <div class="habit-main">
                <h3>${habit.name}</h3>
                <div class="habit-meta">
                  <span>${nextDueLabel(habit)}</span>
                  <span>${completionRate}% last 2 weeks</span>
                </div>
              </div>
              <div class="habit-actions">
                <button data-action="edit" data-id="${habit.id}">Edit</button>
                <button data-action="delete" data-id="${habit.id}">Delete</button>
              </div>
            </div>
          `;
        })
        .join("");
    };

    const renderStreaks = () => {
      const { habits } = getState();
      const streakList = document.getElementById("streakList");
      streakList.innerHTML = habits
        .map((habit) => `
          <div class="habit-item">
            <div class="habit-main">
              <h3>${habit.name}</h3>
              <div class="habit-meta">
                <span class="badge">${getStreak(habit)} day streak</span>
                <span>${nextDueLabel(habit)}</span>
              </div>
            </div>
          </div>
        `)
        .join("");
    };

    const renderSchedule = () => {
      const { habits } = getState();
      const scheduleList = document.getElementById("scheduleList");
      scheduleList.innerHTML = habits
        .map((habit) => `
          <div class="habit-item">
            <div class="habit-main">
              <h3>${habit.name}</h3>
              <div class="habit-meta">
                <span>${nextDueLabel(habit)}</span>
                <span>${habit.frequency === "daily" ? "Due today" : "Due on selected days"}</span>
              </div>
            </div>
          </div>
        `)
        .join("");
    };

    const renderReminders = () => {
      const { habits } = getState();
      const reminderList = document.getElementById("reminderList");
      reminderList.innerHTML = habits
        .map((habit) => `
          <div class="habit-item">
            <div class="habit-main">
              <h3>${habit.name}</h3>
              <div class="habit-meta">
                <span>${habit.reminder ? "Reminder on" : "Reminder off"}</span>
              </div>
            </div>
            <label class="toggle">
              <input type="checkbox" data-action="reminder" data-id="${habit.id}" ${habit.reminder ? "checked" : ""} />
              <span>${habit.reminder ? "On" : "Off"}</span>
            </label>
          </div>
        `)
        .join("");
    };

    const renderAnalytics = () => {
      const { habits } = getState();
      const analyticsPanel = document.getElementById("analyticsPanel");
      analyticsPanel.innerHTML = `
        <div class="analytics-grid">
          ${habits
            .map((habit) => {
              const completion = getCompletionRate(habit);
              const missed = getMissedDays(habit);
              const streak = getStreak(habit);
              return `
                <div class="analytics-card">
                  <h4>${habit.name}</h4>
                  <p>${completion}% completion rate (14 days)</p>
                  <p>${streak} day streak</p>
                  <p>${missed} missed days</p>
                </div>
              `;
            })
            .join("")}
        </div>
      `;
    };

    const renderAll = () => {
      document.getElementById("dateLabel").textContent = formatDateLabel();
      renderToday();
      renderHabits();
      renderStreaks();
      renderSchedule();
      renderReminders();
      renderAnalytics();
    };

    const openDialog = (habit) => {
      dialog.showModal();
      if (habit) {
        editingId = habit.id;
        dialogTitle.textContent = "Edit habit";
        habitForm.querySelector("#habitName").value = habit.name;
        habitFrequency.value = habit.frequency;
        setSelectedDays(habit.days);
        habitForm.querySelector("#habitReminder").checked = habit.reminder;
        habitForm.querySelector("#habitNotes").value = habit.notes || "";
      } else {
        resetForm();
      }
      weeklyDays.hidden = habitFrequency.value !== "weekly";
    };

    const handleQuickAction = (action) => {
      if (action === "open-create") {
        openDialog();
        return;
      }
      if (action === "show-streaks") {
        togglePanels("panel-streaks");
        return;
      }
      if (action === "show-schedule") {
        togglePanels("panel-schedule");
        return;
      }
      if (action === "show-reminders") {
        togglePanels("panel-reminders");
        return;
      }
      if (action === "show-analytics") {
        togglePanels("panel-analytics");
      }
    };

    const handleHabitAction = (action, id) => {
      if (action === "toggle") {
        toggleCompletion(id, todayISO());
        renderAll();
        return;
      }
      if (action === "edit") {
        const habit = getState().habits.find((item) => item.id === id);
        if (habit) openDialog(habit);
        return;
      }
      if (action === "delete") {
        removeHabit(id);
        renderAll();
      }
    };

    const handleReminderToggle = (id, checked) => {
      updateHabit(id, { reminder: checked });
      renderAll();
    };

    habitFrequency.addEventListener("change", () => {
      weeklyDays.hidden = habitFrequency.value !== "weekly";
    });

    habitForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const name = habitForm.querySelector("#habitName").value.trim();
      const frequency = habitFrequency.value;
      const selectedDays = getSelectedDays();
      const days = frequency === "weekly"
        ? (selectedDays.length ? selectedDays : [new Date().getDay()])
        : [0, 1, 2, 3, 4, 5, 6];
      const reminder = habitForm.querySelector("#habitReminder").checked;
      const notes = habitForm.querySelector("#habitNotes").value.trim();

      if (!name) return;

      if (editingId) {
        updateHabit(editingId, { name, frequency, days, reminder, notes });
      } else {
        addHabit(createHabitPayload({ name, frequency, days, reminder, notes }));
      }

      dialog.close();
      resetForm();
      renderAll();
    });

    habitForm.addEventListener("click", (event) => {
      if (event.target?.dataset.action === "close-dialog") {
        dialog.close();
        resetForm();
      }
    });

    window.addEventListener("click", (event) => {
      const action = event.target?.dataset.action;
      if (!action) return;

      if (["open-create", "show-streaks", "show-schedule", "show-reminders", "show-analytics"].includes(action)) {
        handleQuickAction(action);
        return;
      }

      if (action === "reminder") {
        const id = event.target.dataset.id;
        handleReminderToggle(id, event.target.checked);
        return;
      }

      const id = event.target.dataset.id;
      if (id) {
        handleHabitAction(action, id);
      }
    });

    loadState();
    resetForm();
    renderAll();
  </script>
</body>
</html>
